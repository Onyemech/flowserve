✅ FLOWSERVE AI - COMPLETE SYSTEM (NO N8N NEEDED)
================================================

ALL EDGE FUNCTIONS DEPLOYED:
1. whatsapp-webhook-receiver ✅
2. whatsapp-agent ✅
3. paystack-webhook ✅
4. send-payment-confirmation ✅

WHAT THE SYSTEM DOES (100% AUTOMATED):

1. CUSTOMER CONVERSATION (AI Agent)
   - Receives WhatsApp messages
   - AI understands intent (even vague messages)
   - Shows properties/services with images
   - Handles selection by number or name
   - Creates orders in database
   - Generates payment links

2. PAYSTACK PAYMENT FLOW
   - Customer pays via Paystack
   - Webhook receives confirmation
   - Verifies signature
   - Updates order status
   - Initiates transfer to your bank account
   - Marks property as SOLD (NOT deleted yet)
   - Generates invoice (HTML + Text)
   - Sends WhatsApp confirmation to customer
   - Sends email with invoice

3. MANUAL PAYMENT FLOW
   - Admin confirms payment in dashboard
   - Updates order status
   - Marks property as SOLD (NOT deleted yet)
   - Generates invoice
   - Sends WhatsApp confirmation to customer
   - Sends email with invoice

4. AUTO CLEANUP (14 DAYS LATER)
   - Cron job runs daily
   - Finds properties sold 14+ days ago
   - Deletes images from Cloudinary
   - Soft deletes property (sets deleted_at)
   - Updates storage usage tracking
   - Property stays in database for audit

WHAT YOU NEED TO CONFIGURE:

Required Secrets (run these commands):
--------------------------------------
supabase secrets set WHATSAPP_TOKEN=your_token
supabase secrets set WHATSAPP_PHONE_NUMBER_ID=your_id
supabase secrets set WHATSAPP_WEBHOOK_VERIFY_TOKEN=flowserve_2024
supabase secrets set OPENAI_API_KEY=your_openai_key
supabase secrets set AI_PROVIDER=openai
supabase secrets set AI_MODEL=gpt-4o-mini
supabase secrets set APP_URL=https://your-domain.com

Optional (for emails):
supabase secrets set BREVO_API_KEY=your_brevo_key
supabase secrets set SMTP_USER=your_email@gmail.com
supabase secrets set SMTP_PASSWORD=your_app_password
supabase secrets set SMTP_FROM_EMAIL=noreply@yourdomain.com
supabase secrets set SMTP_FROM_NAME="FlowServe AI"

WHERE TO GET CREDENTIALS:

1. WhatsApp: https://developers.facebook.com/apps
   - Create app > Add WhatsApp
   - Get token and phone number ID
   - Configure webhook

2. OpenAI: https://platform.openai.com/api-keys
   - Create API key
   - Costs ~$0.15 per 1M tokens (very cheap)

3. Brevo (optional): https://app.brevo.com/settings/keys/api
   - Free 300 emails/day
   - For invoice delivery via email
   - Simpler than SMTP, works great with Edge Functions

COMPLETE FLOW EXAMPLE:

Customer: "Show me 3 bedroom houses"
→ AI understands, filters properties
→ Sends images with captions

Customer: "I want number 2"
→ AI selects property #2
→ Shows payment options

Customer: "Paystack"
→ Creates order in database
→ Generates payment link
→ Sends link via WhatsApp

Customer pays:
→ Paystack webhook triggered
→ Verifies payment
→ Transfers money to your account
→ Marks property as sold
→ Generates invoice
→ Sends WhatsApp: "✅ Payment confirmed!"
→ Sends email with invoice PDF

DONE! No manual work needed.

TESTING:

1. Add properties/services in dashboard
2. Send WhatsApp message to your business number
3. Follow the conversation
4. Make test payment
5. Check WhatsApp for confirmation
6. Check email for invoice

NO N8N. NO COMPLEX WORKFLOWS. JUST WORKS.

The AI handles everything - understanding, filtering, selection, payment, notifications.
All code is deployed and running on Supabase Edge Functions.
